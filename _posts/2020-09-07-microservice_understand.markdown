---
title: "주니어 개발자의 마이크로서비스(MSA) 이해하기"
date: 2020-09-07
categories:
  - DevOps
tags:
  - DevOps
---

들어가는글
---
마이크로 서비스에 대해 잘 알고있다고 생각했지만, 다른사람들에게 정확하게 설명하지 못할것 같아 좀 더 확실한 개념 정립을 하기위해 쓰는 글

마이크로 서비스 아키텍쳐- MSA의 등장배경?
---
SW가 발달하면서, SW 시스템의 규모가 더욱 더 커져가기 시작했습니다.

우리보다 한 세대 앞서 개발했던 선대 개발자들은 시스템의 규모가 갑자기 커져가면서 직면했던 많은 문제들에 대해 해결방법을 찾으려고 노력하고 이를 전파했습니다. 

즉 SW 설계에서 아키텍쳐나, 자주 발생하는 문제들에 대해 디자인패턴을 정의하여 앞으로 그 실수를 다시 반복하지 않도록, 비슷한 상황에서 발생할수 있는 문제들에 대해서 미리 파악할 수 있게끔 고맙게도 우리에게 전달해준 것이죠.
그 중 MSA는 효율적인 소프트웨어 아키텍쳐에 관해 개발자들이 함께 고민하고 해결 해나간 발자취중 하나라고 볼 수 있습니다.

80~90년대부터 시스템의 규모가 커져가면서, SW를 설계 구조를 정의하는것에 대한 중요성이 대두되어지며, 소프트웨어의 구조를 정의하는 소프트웨어 아키텍쳐라는 개념이 생겨나기 시작했습니다. 그 발자취부터 한번 알아보겠습니다.

소프트웨어 아키텍쳐의 종류
---
MSA 외에도 소프트웨어 아키텍쳐는 여러가지 존재합니다. MSA가 가장 좋은것이 아니라, 각 아키텍쳐마다 장단점이 있다고 할 수 있습니다.
규모가 작은 프로그램에서는 모노리스 아키텍쳐가 더 효율적일수 있다는거죠!

1. 모노리스 아키텍쳐
2. SOA
3. MSA  

이제는 클라우드 환경이 신뢰도가 높아진 현재에는 서버리스 아키텍쳐가 대두되어지고 있긴 합니다만, 이 글에서는 MSA까지의 단계만 다루어 보려고 합니다.


MSA는 왜 등장 했는가?
---
마이크로 서비스 아키텍쳐의 등장 배경에 대해 이해하려면 그 전에 SOA(Service Oriented Architecture)와 모노리식 아키텍쳐(Monolithic Architecture) 에 대해 이해하고, MSA가 두 아키텍쳐에 비해 어떤 장점을 가질 수 있었는지 알아봐야만 합니다.  
<br/>


> # 1. SOA(Service Oriented Architecture)  
---
SOA는 서비스 지향 아키텍쳐라고 불립니다.  

 기존 애플리케이션의 기능을 비즈니스 도메인을 가지는 기능 단위로 분리하고, 이를 표준화된 호출 인터페이스를 통해 작은 서비스 단위로 재 조합하는 방식의 아키텍쳐입니다.  
맞습니다, OOP 공부하신분이라면 자주 들었을 법한 모듈화의 개념을 비즈니스 도메인에 따라 적용한것입니다. 즉, 회사 내에서 기능 단위로 행위들을 모듈화하여 하나의 레고블럭(인터페이스)처럼 모듈화 시켜, 어디서든 끼워넣으면 빠르게 작동할 수 있게 만드는 아키텍쳐입니다.

레고블럭은 삼각형, 사각형, 원형, 나무, 사람, ... 등 각종 기본 객체가 다수 들어 있는데 표준 원칙(비즈니스 로직)에 따라 접속부를 정교하게 만들었기 때문에 여러 개를 조합하여 새로운 장남감을 쉽고, 빠르게 만들 수 있습니다. 그것도 기본 모형만 있는 것이 아니라 자동차, 비행기, 로봇트 등을 만들 수 있는 복잡한 모형도 조합되도록 준비되어 있습니다.

이 레고블럭(인터페이스)가 합쳐져서 만들어진 서비스는 재사용을 위해 공개되어 있기 때문에 차후 개발에서는 그 부분의 개발이 필요 없어 개발 기간을 단축시키고, 개발 오류를 현저히 감소시킬 수 있다는 장점이 있습니다. 하지만 비즈니스 도메인은 각 회사마다 달라질 수 있겠죠?
이는 즉, A라는 회사의 SOA를 B회사의 SOA에 접목시킬 수 없다는 말입니다. 

즉, 각 회사마다 인터페이스가 달라서, 한 비즈니스도메인(회사) 내에 국한되어진다는 단점이 있습니다.

##### 참고자료
 - ##### [SOA (Service Oriented Architecture) 개념 이해하기](https://blog.naver.com/atweb/10092816348)  
 -  ##### [조대협님 의 What is SOA? How to SOA?](https://bcho.tistory.com/48)
<br>  



> # 2. Monolithic Architecture
---
Monolith, 단단하고 끈끈하게 묶여있는.  
풀어 말해 결합도가 높은 시스템 아키텍쳐를 말합니다.  
규모가 작은 프로젝트에서 자주 사용되어집니다.


![](../../img/mono_arc.jpeg)  


##### [이미지 출처](https://medium.com/koderlabs/introduction-to-monolithic-architecture-and-microservices-architecture-b211a5955c63)

모노리스 아키텍쳐는 일반적으로 위와같은 형태로 구성되어집니다.

이것이 나쁘다는것은 아닙니다, 하지만 시스템의 규모가 커져가면서 유지보수에 대한 이슈가 더욱 더 많이 발생할 여지가 많아지기 때문에 모노리스 아키텍쳐로 설계된 시스템은 유지보수 비용이 다소 많이 들고, 자주 바뀌는 트래픽에 대한 대처가 쉽지 않은등 다양한 "불편함"이 존재합니다.  

시스템이 점점 더 커지는것이 필수 불가결로 여겨지는 요즘, 국내 기업들도 Digital Transformation 이라는 슬로건을 앞세우고 앞다퉈 기존 시스템들을 MSA 아키텍쳐로 변환하려는 노력을 하고 있습니다.

그렇다면 Monolithic 아키텍쳐에서 발생하는 문제점은 무엇인지 알아보기위해 [넷플릭스가 모노리식에서 마이크로서비스로 변해가는 과정과 MSA 적용 후 발생한 문제점들을 개선하고 아키텍쳐를 더 발전시켜나가는 과정에 관한 발표](https://www.youtube.com/watch?v=CZ3wIuvmHeM) 를 예시로 들어보려합니다.  
  

<img src="https://github.com/jaehyunup/jaehyunup.github.io/blob/master/img/ma_arc.png?raw=true" 
width="80%" style="display:block;margin-left:auto;margin-right:auto;margin-top:5%; margin-bottom:5%"/>

넷플릭스는 기존에 전형적인 형태의 아키텍쳐를 사용했다고 합니다. 웹서버와,어플리케이션 서버에서 로직을 처리하고, Jdbc를 이용해 Oracle DB에 연결되어있는 형태의 아키텍쳐이죠.

이때 아래와 같은 문제가 발생했다고 합니다.  

#### 1. 문제 또는 변경사항이 발생되었을때 버그를 찾기가 힘들었다는 점.
자바로 작성된 기반 코드가 매주 배포되는 하나의 코드베이스에 적용되어지고, 코드의 복잡도는 점점 더 늘어나게 되었다.

####  2. 메모리 누수가 일어나는, 성능이 느려지는 코드를 찾아내기가 힘들었다는 점.
코드 복잡도가 늘어나니 성능저하를 일으키는 코드나 메모리를 과도하게 사용하는 코드를 찾기가 힘들었다.

#### 3. 메인 데이터베이스가 다운되면 모든 작업이 불가능했다.즉, DB의존도가 매우 컷다
STORE 데이터베이스라고 하는 하나의 큰 Oracle DB를쓰는 하드웨어가 다운되었을때 모든것이 작동이 불가능했고, 또한 지속적으로 커져가는 DB를 감당하기 위해 이를 감당할 수 있는 매년 더 비싼 비용의 하드웨어를 새로 구매해야했다. 
그리고 애플리케이션 내에는 테이블 스키마를 요청하는 코드가 매우 많았으며, 테이블에 열을 추가하는 것도 고려할 사항이 엄청나게 많아지게 되었다.

위와같은 문제는 넷플릭스의 엔지니어들을 고통에 빠지게 했습니다. 그래서 MSA를 도입했다고 합니다.

이외에도 알려진 모노리식 아키텍쳐의 문제점들은 꽤 많이 있습니다. 하지만 규모가 작은 시스템에서는 발생하지 않는 문제일 수 있습니다. 즉, 마냥 나쁜 아키텍쳐는 아니지만 시스템 확장성을 고려해서 좋은 아키텍쳐는 아닐 수 있다는 것을 알아야만 합니다. 



> # MSA - Micro Service Architecture
---
드디어 본론입니다. MSA는 무엇일까요? 어떤 장점들이 있길래 다들 강조하는것일까요? 

2013년말, 마틴 파울러는 마이크로서비스에 대한 명확한 정의가 없다는 우려가 생겨 제임스 루이스씨와 함께 마이크로 서비스에대한 확고한 정의를 내렸고 현장에서 직접 겪었던 마이크로서비스 아키텍쳐의 공통 특성을 나열하여 정리하였습니다. 관심있으신 분들은 [마틴 파울러님의 블로그](https://martinfowler.com/articles/)에서 마이크로서비스를 더 깊이 알 수 있습니다.

아래는 MSA에 대해 정의한 대표 주자 마틴 파울러 (Martin Fowler)님의 간단한 정의입니다.

> In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery. There is a bare minimum of centralized management of these services, which may be written in different programming languages and use different data storage technologies  - James Lewis and Martin Fowler (2014)

> 마이크로 서비스 아키텍쳐는, 단일 애플리케이션을 소규모 서비스 단위로 구분하여 개발하는 접근방식으로 각각 자체의 프로세스에서 실행되고, 경량 매커니즘(http resource API과 같은) 과 통신합니다. 이 작은 단위의 서비스를 구분하는 것은, 비즈니스 로직을 중심으로 하며 독립적으로 배치 가능한 완전 자동화된 배포가 이루어져야 합니다. (생략)


말로 하니까 매우 어렵습니다, 뭔가 나눈다는것은 SOA랑 비슷한것 같고, 모놀리식 내부에서도 나눌수 있지 않습니까? 근데 저 말에는 한가지 키포인트가 있습니다.

*각각 자체의 프로세스에서 실행되고, 경량 매커니즘(http resource API과 같은)과 통신합니다.*

그림으로 단번에 이해해볼까요?  

## 모노리스 아키텍쳐
<img src="https://github.com/jaehyunup/jaehyunup.github.io/blob/master/img/mono_1.png?raw=true" 
width="80%" style="display:block;margin-left:auto;margin-right:auto;margin-top:5%; margin-bottom:5%"/>
<br/>  

## 마이크로서비스 아키텍쳐
<img src="https://github.com/jaehyunup/jaehyunup.github.io/blob/master/img/msa_2.png?raw=true" 
width="80%" style="display:block;margin-left:auto;margin-right:auto;margin-top:5%; margin-bottom:5%"/>





##### [모놀리식 아키텍쳐와 마이크로서비스 아키텍쳐 사진 원본 글](http://khoadinh.github.io/2015/05/01/microservices-architecture-overview.html)

위 그림에서 단번에 알아볼 수 있는것은 서비스들이 여러개의 작은 서비스로 분리되었고, API 게이트웨이가 서비스와 통신하게 됩니다. 예를들어 결제,재고관리,검색 서비스가 하나로 통합되어있다가, 별도의 서비스로 나누어 동작하게 된것입니다.그리고 서비스별로 별도의 DB구성을 통해 DB 의존도도 낮추게 되었죠.  

즉, 마이크로서비스의 도입을 통해 넷플릭스가 모놀리식 아키텍쳐에서 발생했던 문제점들이 해결될 수 있게 되었습니다, 코드베이스가 하나로 되어있어서 코드 간 의존도가 매우 높았던 점. 단일 DB를 이용했기때문에 유지보수, 그리고 DB의존도가 매우 높았던 점 등등 위에서 발견했던 모놀리식 아키텍쳐의 문제점들을 효과적으로 해결 해 나갈 수 있다는 것을 알게됩니다.

하지만 마냥 좋은것만은 아닙니다.  
마이크로 서비스는 득과 실,즉 trade off가 존재합니다.

### 마이크로 서비스를 접목했을때의 장점
- 강력한 모듈화, 그리고 경계 : 마이크로 서비스는 대규모 팀에 특히 중요한 모듈 구조를 강화함으로써 서비스간 경계가 확실해집니다. 이는 서비스 코드간 의존도를 낮출 수 있습니다.

- 독립 배포 : 단순한 서비스는 배포하기가 더 쉽고 자율적이므로 잘못되었을 때 시스템 오류를 일으킬 가능성이 적습니다.  

- 기술 다양성 : 마이크로 서비스를 통해 여러 언어, 개발 프레임 워크 및 데이터 스토리지 기술을 혼합 할 수 있습니다.

### 하지만 마이크로 서비스를 감당하기위해서는 아래와 같은 비용이 필요합니다.
- 배포 측면 : 원격 호출이 느리고 항상 실패 할 위험이 있으므로 분산 시스템은 프로그래밍하기가 더 어렵습니다.  

- 결과적 일관성 측면 : 분산 시스템에서 강력한 일관성을 유지하는 것은 매우 어렵습니다. 즉, 모든 사람이 결과적 일관성을 관리해야합니다.  

- 운영 복잡성 측면 : 정기적으로 재배포되는 많은 서비스를 관리하려면 성숙한 운영 팀이 필요합니다.

위와같이 마이크로서비스의 장점과, 이를 감당하기위한 비용이 함께 따라오게 됩니다. 즉 이를 잘 접목시켜서 활용할 수 있을때에 마이크로서비스를 접목시켜야 좋은것이라고 알수 있습니다.

그래서 마이크로서비스와 함께 Devops의 중요성이 부각되어지고 있는 것이겠지요. 

마치며
---
이번 글에서는 마이크로서비스를 왜 사용하는지, 어떤 장점이 있는지 간단하게 알아보았습니다.  
다음 글에서는 마이크로서비스는 어떻게 구현되어 지는지 더 자세히 알아보려합니다.